# MYSQL 隔離等級

在 MySQL 中，隔離等級（Isolation Level）是指資料庫系統為了處理並發事務而採取的一種機制，用來定義交易之間的相互影響程度。 MySQL 支援多種隔離等級。

## 引發問題
這些問題都是由於資料庫中的事務併發操作引起的，它們分別是：

* 髒讀（Dirty Read）：
髒讀指的是一個事務讀取了另一個事務未提交的資料。假設事務A 修改了某一行數據，但是還沒有提交，此時事務B 讀取了這個未提交的數據，然後事務A 回滾了操作，那麼事務B 就會讀取到已經被撤銷的數據，這就是髒讀。

* 不可重複讀（Non-Repeatable Read）：
不可重複讀指的是在同一個交易中，同一查詢在不同時間執行時傳回了不同的結果。假設事務A 在讀取某一行數據時，事務B 修改了該行數據並提交，然後事務A 再次讀取同一行數據，此時得到的結果與第一次讀取時不同，這就是不可重複讀。

* 幻讀（Phantom Read）：
幻讀指的是在同一個事務中，同一查詢在不同時間執行時傳回了不同數量的結果行。假設事務A 查詢了某個範圍的數據，然後事務B 插入了一行符合條件的新數據並提交，然後事務A 再次查詢同一範圍的數據，此時返回的結果行數比第一次查詢時多，這就是幻讀。

## 隔離等級

* READ UNCOMMITTED（讀取未提交）：
在該隔離等級下，事務可以讀取其他事務尚未提交的數據，可能會出現髒讀、不可重複讀取和幻讀等問題。

* READ COMMITTED（讀取已提交）：
在該隔離等級下，事務只能讀取其他事務已經提交的數據，可以避免髒讀，但仍可能出現不可重複讀取和幻讀等問題。

* REPEATABLE READ（可重複讀取）：
在該隔離等級下，事務在整個事務期間看到的資料都是一致的，即使其他事務提交了資料也不會影響當前事務的讀取，可以避免髒讀和不可重複讀，但仍可能出現幻讀問題。

* SERIALIZABLE（可串列化​​）：
在該隔離層級下，事務被排隊執行，確保了事務的串行化執行順序，可以避免髒讀、不可重複讀取和幻讀等問題，但會降低並發效能。

* 在 MySQL 中，默认的隔离级别是 REPEATABLE READ。你可以使用 SET TRANSACTION 或 SET SESSION TRANSACTION 命令来设置事务的隔离级别

## 樂觀/悲觀鎖

* 樂觀鎖（Optimistic Locking）： 樂觀鎖是一種樂觀的並發控制策略，它假設在大多數情況下，資料不會發生衝突。因此，事務在讀取資料時不會取得任何鎖，而是在提交事務時檢查資料是否已被其他事務修改。如果發現資料被修改，則拒絕目前交易的提交，並提示使用者重新嘗試。樂觀鎖通常是透過在表中添加一個版本號或時間戳字段來實現的。在更新資料時，交易會比較目前資料的版本號或時間戳記與讀取資料時的版本號或時間戳記是否一致，如果一致則說明資料未修改，可以繼續更新操作；如果不一致，則說明資料已被其他事務修改，需要回滾或重新嘗試。樂觀鎖適用於讀取操作遠遠多於寫入操作的場景，可以提高系統的並發效能，但需要處理資料衝突的情況，並增加了事務回溯和重試的複雜性。(mvcc 算是樂觀鎖的實現之一)

* 悲觀鎖（Pessimistic Locking）： 悲觀鎖是一種悲觀的並發控制策略，它假設在任何時候都會有其他事務嘗試修改相同的數據，因此在進行操作之前先獲取鎖。悲觀鎖通常是透過資料庫提供的鎖機制（如行鎖或表鎖）來實現的。使用悲觀鎖時，交易會在修改資料之前取得鎖，並在事務結束時釋放鎖。這樣可以確保資料在被修改期間不會被其他事務存取或修改，但會導致並發效能下降，並增加死鎖的風險。

## 排他/共享鎖

+ 共享鎖是一種讀鎖，當某行或某表被加上共享鎖後，其他事務仍可讀取該數據，但無法對該數據進行修改。

* 排他鎖是一種寫鎖，一旦某行數據被加上排他鎖，其他事務無法對該行進行任何操作，直到鎖被釋放。

* INSERT、UPDATE 和 DELETE 操作會隱式加排他鎖，但在需要顯式鎖定時，可以使用 SELECT ... FOR UPDATE。
