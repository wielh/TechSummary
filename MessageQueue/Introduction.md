# Message Queue Introduction

## 簡介

訊息佇列（Message Queue，MQ）是一種通訊方法，它允許不同的系統和元件透過發送和接收訊息進行非同步通訊。訊息佇列的主要作用是解耦系統中的各個元件，提高系統的可擴展性和可靠性。

## 核心概念

+ 訊息（Message）：訊息是訊息佇列中傳送的資料單元，通常包含訊息標頭（metadata）和訊息體（payload）。

+ 佇列（Queue）：佇列是訊息儲存的容器，遵循先進先出（FIFO）原則。生產者將訊息放入隊列，消費者從隊列中讀取訊息。

+ 生產者（Producer）：生產者是負責傳送訊息至訊息佇列的元件或應用。

+ 消費者（Consumer）：消費者是負責從訊息佇列讀取和處理訊息的元件或應用。

+ 中介軟體（Broker）：訊息佇列的中間件負責管理訊息佇列的儲存、傳輸和調度，如 RabbitMQ、Apache Kafka 等。

## 常見用途

+ 解耦系統：訊息佇列將生產者和消費者解耦，使得系統的各個元件可以獨立演化和擴展。

+ 負載平衡：透過將訊息分發給多個消費者，訊息佇列可以實現負載平衡，提高系統的處理能力。

+ 非同步處理：訊息佇列可以實現非同步處理，生產者可以將訊息傳送到佇列中，不必等待消費者處理完畢，繼續執行其他任務。

+ 削峰填谷：訊息佇列可以在高峰期緩衝大量要求，平滑流量，避免系統過載。

## 常見的 Message Queue 比較
| 特性   | Kafka         | RabbitMQ        | RocketMQ          |
| ---- | ------------- | --------------- | ----------------- |
| 設計理念 | 分散式、高吞吐、日誌型儲存 | AMQP 實作，強調靈活路由  | 高一致性、高可靠消息        |
| 協定   | 自定義 TCP       | AMQP/STOMP/MQTT | 自定義 TCP           |
| 消息模式 | Log-based 順序流 | 多種交換機路由         | Pub/Sub + 順序/延遲消息 |
| 訊息保留	| 永久儲存（可設定 TTL）| 	記憶體為主（可設定持久化）	| 可配置保留策略（預設持久）| 
| 訊息順序	| Partition 層級順序	| 預設無順序（可加強）| 	原生支援嚴格順序| 
| 消息可重試 | 	Client 控制 offset | 重試	Broker 控制重送/ack	| 內建 retry、死信隊列| 
| 事務支持	| ✅（複雜）	| ❌（需自實作）	| ✅ 原生支援事務消息| 
| 消費模式	| Pull	| Push（也支援 Pull）| 	Pull（支援 batch pull）| 
| 消費狀態追蹤	| Client 自管 offset	| Broker 管 ack	| 支援 offset/ack 查詢| 
